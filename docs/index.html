<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Getting Started</title>
    <link rel="stylesheet" type="text/css" href="./assets/css/styles.css">
    <script src="https://unpkg.com/lodash@4.17.20"></script>
    <style>
      .code-style {
        padding: 0.5em; 
        border:1px solid #ccc; 
        background: rgb(230, 230, 230);
      }
      .response-style {
        display: block; 
        overflow-x: auto; 
        padding: 0.5em; 
        background: rgb(51, 51, 51); 
        color: white; 
        margin: 0;
      }
    </style>
  </head>

  <body>
    <main>
      <script src="./src/index.js"></script>
      <div class="l-page">
        <div class="l-constrain">
          <h1>Clean Air Markets ECMPS Beta API Examples</h1>
          <button type="button" class="usa-button">Default</button>
          <p>Below are some examples of how the ECMPS Beta API endpoints could be used to find useful information you may be looking for.</p>
          <p>An easy way to start is by using the configurations endpoint in the <a target="_blank" href="https://www.epa.gov/power-sector/cam-api-portal#/swagger/beta-monitor-plan-mgmt">Monitoring Plan API</a>.
          <p>Run the JS script below.</p>
          <pre class="code-style">
            <code>const response = await fetch('https://api.epa.gov/easey/beta/monitor-plan-mgmt/configurations?orisCodes=3',
                {
                  headers: {
                    "x-api-key": "YOUR_API_KEY_HERE"
                  },
                  "referrer": "https://usepa.github.io/",
                  "method": "GET",
                });
              const data = await response.json();</code>
          </pre>
          
          <p>Below is the resonse.</p>
          
          <div style="height:400px;border:1px solid #ccc;overflow:auto; margin:0 2em;">
            <pre id="monitoringPlanConfigResponse" class="response-style">
              loading...
            </pre>
          </div>
          
          <p>The first "Id" of each object in the response is the unique identifier (Id) of a monitoring configuration record. You will see this as parameters 
            to use in other endpoints (named: monPlanIds or planIds). For example, lets take the first monitoring plan id in the response above and use it.</p>
          <pre class="code-style"><code>const monPlanId = <span id="monitoringPlanId"></span></code></pre>
        
          <p>Run the JS script below.</p>
          <pre class="code-style">
            <code>const response = await fetch('https://api.epa.gov/easey/beta/emissions-mgmt/configurations',
                {
                  headers: {
                    "x-api-key": "YOUR_API_KEY_HERE"
                  },
                  "referrer": "https://usepa.github.io/",
                  "method": "GET",
                });
              const data = await response.json();</code></pre>
          
          <p>Below is the resonse.</p>
          
          <div style="height:400px;border:1px solid #ccc;overflow:auto; margin:0 2em;">
            <pre id="emissionsExportResponse" class="response-style">
              loading...
            </pre>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>

<script>
  (async () => {
    var API_KEY = process.env.API_KEY;
    console.log(API_KEY);
    const monPlanConfigResponse = await fetch('https://api.epa.gov/easey/beta/monitor-plan-mgmt/configurations?orisCodes=3',
      {
        headers: {
          "x-api-key": process.env.API_KEY
        },
        "referrer": "https://usepa.github.io/",
        "method": "GET",
      });
    const monPlanData = await monPlanConfigResponse.json();
    const monPlanElem = document.getElementById("monitoringPlanConfigResponse");
    monPlanElem.innerHTML = '<code class="language-json">'+JSON.stringify(monPlanData, null, 4);+'</code>'
    const monPlanId = monPlanData[0].id;
    document.getElementById("monitoringPlanId").innerHTML = monPlanId;
    
    const emissionsExportResponse = await fetch('https://api.epa.gov/easey/beta/emissions-mgmt/emissions/export?monitorPlanId='+monPlanId+'&year=2022&quarter=4',
      {
        headers: {
          "x-api-key": "DEMO_KEY"
        },
        "referrer": "https://usepa.github.io/",
        "method": "GET",
      });
    const emissionsExportData = await emissionsExportResponse.json();
    const emissionsExportElem = document.getElementById("emissionsExportResponse");
    emissionsExportElem.innerHTML = '<code class="language-json">'+JSON.stringify(emissionsExportData, null, 4);+'</code>'
  })();
</script>
